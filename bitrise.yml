format_version: "11"
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git

app:
  envs:
  - FLUTTER_VERSION: "3.19.0"
  - FLUTTER_HOME: $HOME/flutter
  - PATH: $FLUTTER_HOME/bin:$PATH

workflows:
  primary:
    steps:
    - activate-ssh-key@4:
        run_if: '{{getenv "SSH_RSA_PRIVATE_KEY" | ne ""}}'
    - git-clone@8: {}
    - cache-pull@2: {}
    - script@1:
        title: "Install Flutter"
        inputs:
          script_content: |
            #!/bin/bash
            set -ex
            git clone https://github.com/flutter/flutter.git $FLUTTER_HOME
            flutter doctor
    - flutter-installer@0:
        inputs:
          version: $FLUTTER_VERSION
    - flutter-analyze@0:
        inputs:
          project_location: "frontend"
    - flutter-test@0:
        inputs:
          project_location: "frontend"
    - flutter-build@0:
        inputs:
          project_location: "frontend"
          platform: "ios"
          ios_output_type: "archive"
    - deploy-to-bitrise-io@2: {}
    - cache-push@2: {}
